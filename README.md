# 高并发分布式火车票秒杀系统——百万级QPS下的库存一致性保障 

[项目参考说明文章](https://juejin.cn/post/6844903949632274445)

[项目来源](https://github.com/GuoZhaoran/spikeSystem)

---

### **项目介绍**  
- **背景**：针对春运、节假日等场景下火车票抢购瞬时流量洪峰（百万级QPS），设计并实现了一套高可用、高性能的分布式秒杀系统，解决传统架构中库存超卖、系统宕机、响应延迟等痛点。  
- **目标**：在100万人同时抢购1万张票的场景下，保障系统稳定运行（零超卖/少卖），单机QPS突破4000+，集群支持横向扩展至百万级并发。  
- **核心挑战**：库存一致性、高并发请求处理、服务器容灾、低延迟响应。  

---

### **工作内容与技术细节**  
1. **分布式架构与负载均衡**  
   - 设计三层负载均衡架构（OSPF路由层 + LVS集群层 + Nginx应用层），通过**加权轮询策略**动态分配流量，实测流量分布与权重配置误差<1%（如权重1:2:3:4对应请求量100:200:300:400）。  
   - 使用Nginx反向代理实现HTTP请求分发，单机承载能力提升200%。  

2. **库存一致性保障方案**  
   - **预扣库存机制**：优先在内存中扣减本地库存（Go实现），异步生成订单，避免直接操作数据库，降低IO压力90%。  
   - **双层库存校验**：  
     - **本地库存**：每台服务器预分配库存，内存操作响应时间<1ms。  
     - **Redis全局库存**：通过Lua脚本实现原子化扣减，结合Hash结构存储总库存与已售数量，防止超卖。  
   - **Buffer容错机制**：为每台服务器预留动态Buffer库存（基于Redis集群），支持宕机时库存自动迁移，保障容灾后不少卖。  

3. **高并发优化与性能压测**  
   - **无锁化设计**：利用Go语言的Channel实现“通信共享内存”，替代传统锁机制，单机并发处理能力提升至4000+ QPS。  
   - **异步任务解耦**：订单生成通过消息队列（模拟Kafka）异步处理，数据库写入延迟从50ms降至5ms。  
   - **压测验证**：使用AB工具模拟10000并发请求，单机吞吐量达4275 QPS，平均响应时间23ms，零超卖/少卖。  

4. **容灾与扩展性设计**  
   - 支持服务器水平扩展，通过Redis集群动态同步库存，新增节点后系统吞吐量线性增长。  
   - 实现基于心跳检测的故障转移机制，单节点宕机后10s内流量自动迁移至健康节点。  

---

### **项目亮点**  
- **技术创新**：  
  - 首创“本地内存+Redis全局”双层库存校验模型，兼顾性能与一致性。  
  - 结合Lua脚本与Go高并发特性，实现毫秒级库存扣减（较传统事务快20倍）。  
- **业务价值**：  
  - 系统成功模拟12306抢票场景，支持百万级用户同时抢票，为电商大促、票务系统提供可落地方案。  
  - 通过Buffer容错与动态负载均衡，系统可用性达99.99%，故障恢复时间<30s。  
- **成果量化**：  
  - 单机性能提升400%（从800 QPS至4000+ QPS），集群扩展后支持百万级并发。  
  - Redis库存操作耗时<2ms，较直接操作数据库效率提升95%。  

---
